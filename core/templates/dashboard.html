{% extends 'base.html' %}
{% load static %}
{% block title %} Dashboard{% endblock %}
{% block content %}
<style>
    table {
        width: 100%;
        height: fit-content;
        padding: 20px 5px;
        border-radius: 10px;
        border: solid 1px #D9D9D9;
        background-color: #FFF;
        width: 100%;
        margin-top: 3rem;
    }
    table thead th {
       padding: 5px;
    }
    table thead th h5 {
        width: fit-content;
        color: #000;
        font-family: 'Albert San', sans-serif;
        font-size: 14px;
        font-weight: 600;
        padding: 10px 20px;
        border-radius: 10px;
        border: solid 1px #D9D9D9;
        margin-bottom: 10px;
    }
    table tbody tr td {
        width: fit-content;
        padding: 10px;
        color: #000;
        font-size: 13px;
        font-weight: 400;
        font-family: 'Albert Sans', sans-serif;
        border-bottom: solid 1px #D9D9D9;
    }
    .wallet-address {
        width: 100%;
        display: flex;
        gap: 30px;
        flex-direction: row-reverse;
        /* justify-content: space-between; */
        justify-content: start;
        align-items: center;
    }
    .wallet-address div {
        width: fit-content;
    }
    .crypto-table {
        width: 100%;
        height: fit-content;
        padding: 30px;
        display: flex;
        flex-direction: column;
        align-items: flex-start;
        justify-content: flex-start;
        gap: 20px;
        margin-bottom: 5rem;
    }
    .view_box {
        text-align: center;
        margin-top: 2rem;
    }
    .view_box .view_details {
        font-family: 'Albert Sans', sans-serif;
        font-size: 16px;
        font-weight: 500;
        line-height: 19px;
        letter-spacing: 0.30000001192092896px;
        color: #001F8B;
        background: #fff;
        border-radius: 5px;
        border: 1px solid gray;
        padding: 8px 16px;
        transition: all 200ms ease;
        text-decoration: none;
    }
</style>
    <!-- main content -->
    <div class="main_content_container">
        <div class="main_head_box" onclick="popUpcontent()">
            <div class="virtual_card_head">
                {% if cards %}
                <div class="visible-text_box" id="hideCardDetails">
                    <div class="h5_show_text-box">
                        <h5 id="showText">Show</h5>
                    </div>
                    
                    <div class="eye-icon-hide" id="eyeIconHide">
                        <svg width="21" height="17" viewBox="0 0 21 17" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M3.04557 16.1254C2.86791 16.1254 2.69024 16.0576 2.55491 15.922C2.28378 15.6511 2.28378 15.2116 2.55491 14.9407L17.2923 0.203346C17.5634 -0.0677819 18.0025 -0.0677819 18.2736 0.203346C18.5447 0.474242 18.5447 0.913783 18.2736 1.18468L3.53624 15.922C3.40091 16.0576 3.22324 16.1254 3.04557 16.1254Z" fill="black"/>
                            <path d="M5.85191 13.3118C5.73532 13.3118 5.6178 13.2824 5.51092 13.222C3.72569 12.2148 1.92542 10.6271 0.160317 8.5034C-0.0534389 8.24616 -0.0534389 7.87324 0.160317 7.61622C5.14171 1.62366 10.2385 0.0359883 15.3094 2.89717C15.4982 3.00382 15.6266 3.19259 15.656 3.40773C15.6854 3.62288 15.6125 3.83894 15.4589 3.99232L6.34281 13.1084C6.20933 13.2421 6.03166 13.3118 5.85191 13.3118ZM1.60386 8.0597C2.98541 9.655 4.3739 10.8917 5.74272 11.7458L13.803 3.68557C9.74648 1.83626 5.74272 3.27356 1.60386 8.0597Z" fill="black"/>
                            <path d="M7.96051 11.2101C7.7766 11.2101 7.60009 11.1372 7.46984 11.007C6.68329 10.2207 6.25 9.17501 6.25 8.06251C6.25 5.76649 8.11805 3.89844 10.4141 3.89844C11.5127 3.89844 12.5493 4.32248 13.3329 5.09283C13.4645 5.22238 13.5394 5.39866 13.5404 5.58327C13.5413 5.76788 13.4691 5.94531 13.3393 6.07648L8.45326 11.0049C8.32325 11.1358 8.1465 11.2099 7.9619 11.2103C7.96143 11.2101 7.96097 11.2101 7.96051 11.2101ZM10.4141 5.28646C8.88331 5.28646 7.63802 6.53175 7.63802 8.06251C7.63802 8.56567 7.77081 9.04824 8.01996 9.4702L11.8009 5.6566C11.3834 5.41509 10.9082 5.28646 10.4141 5.28646Z" fill="black"/>
                            <path d="M10.4082 14.6C9.58653 14.6 8.76482 14.4841 7.94288 14.2519C7.57413 14.1478 7.35968 13.7642 7.46378 13.3952C7.56788 13.0265 7.95075 12.8113 8.32042 12.9164C11.8904 13.9248 15.5562 12.2929 19.2206 8.06244C18.3006 7.00014 17.3745 6.09283 16.4619 5.36042C16.163 5.12052 16.1151 4.68376 16.355 4.38464C16.5951 4.08575 17.0321 4.03786 17.3308 4.27776C18.4403 5.16818 19.5618 6.29225 20.6641 7.61874C20.8781 7.87575 20.8781 8.2489 20.6641 8.50591C17.2952 12.5592 13.8554 14.6 10.4082 14.6Z" fill="black"/>
                            <path d="M10.4098 12.2293C10.3205 12.2293 10.2317 12.2263 10.144 12.221C9.76139 12.1976 9.47014 11.8687 9.4935 11.4858C9.5171 11.1037 9.84675 10.8129 10.2287 10.8355C10.2886 10.8392 10.349 10.8413 10.4098 10.8413C11.9406 10.8413 13.1859 9.59603 13.1859 8.06527C13.1859 8.00281 13.1838 7.94081 13.1799 7.8795C13.1551 7.4971 13.445 7.16675 13.8274 7.142C14.2126 7.11817 14.5404 7.40711 14.5651 7.78951C14.5709 7.88066 14.5739 7.9725 14.5739 8.06527C14.5739 10.3613 12.7059 12.2293 10.4098 12.2293Z" fill="black"/>
                        </svg>
                    </div>
                </div>
                
                <a href="{% url "cards" %}">
                <div class="container">
                    <div id="cardCarousel" class="cards-swiper-container">
                        <div class="swiper-wrapper">
                            {% for card in cards %}
                            <div class="swiper-slide">
                                <div class="Bank_image-icon">
                                    <div class="virtual_card_valid-container">
                                        <div class="virtual-account_number">
                                            <h3 class="card_mask_number" data-card-number="{{ card.card_number }}" data-card-number-mask="{{ card.card_masked_number }}">{{card.card_number_mask}}</h3>
                                        </div>
            
                                        <div class="thru_cvv_box">
                                            <div class="valid-text">
                                                <p>Valid Thru</p>
                                                <span class="year_span">{{card.card_expiration_date}}</span>
                                            </div>
            
                                            <div class="valid-cvv_box">
                                                <p class="valid-cvv_text">CVV</p>
                                                <span class="valid-cvv_span cvvHideElements" data-card-security-code="{{ card.card_cvv }}">***</span>
                                            </div>
                                        </div>
            
                                        <div class="account_hoder-name">
                                            <h3>{{card.user.first_name}} {{card.user.last_name}}</h3>
                                        </div>
                                        
                                    </div>
                                </div>
                            </div>
                            <style>
                                .swiper-slide .Bank_image-icon {
                                    {% if card.brand == "Visa" %}
                                    background-image: url('{% static "images/visa-card-logo.svg" %}');
                                    {% else %}
                                    background-image: url('{% static "images/master-card-logo.svg" %}');
                                    {% endif %}
                                    background-size: cover;
                                    width: 298px;
                                    height: 180px;
                                    background-repeat: no-repeat;
                                    background-size: cover;
                                    background-position: center;
                                    border-radius: 10px;
                                }
                            </style>
                            {% endfor %}
                        </div>
                        
                        <div class="swiper-button-next"></div>
                        <div class="swiper-button-prev"></div>
                    </div>
                </div> 
                </a>

                <div class="view_box">
                    <a href="{% url "cards" %}" class="view_details" id="veiwDetails">View All Cards</a>
                </div>   
                {% else %}
                <div class="view_box">
                    <a href="{% url "cards" %}" class="view_details" id="veiwDetails">Create a Virtual Card</a>
                </div>
                {% endif %} 

                <div class="total_con_box">
                    <div class="total_card_main">
                        <p>Total Cards:</p>
                        <span>{{card_count}}</span>
                    </div>

                    <div class="total_transaction_box">
                        <p>Total Transactions:</p>
                        <span>{{ transaction_count }}</span>
                    </div>
                </div>
            </div>

            <!-- usa section -->
            <div class="usa_container-box">
                <div class="usa_main">
                    <div class="us_image-box">
                        <img src="{% static "images/usa-flag-circular.png" %}" alt="">
                    </div>
                        
                    <div class="dollar_box">
                        <h4>United States Dollar</h4>
                        <div class="top_cash_dollar">
                            {% comment %} <img src="{% static "images/Dollar-black-icon.svg" %}" alt="Black dollar"> {% endcomment %}
                            <h3>${{request.user.profile.wallet_balance}}</h3>
                        </div>
                    </div>
                    <div class="add_money-box">
                        <a href="{% url "crypto" %}">
                            <div class="plus_image">
                                <img src="{% static "images/add-01.svg" %}" alt="Plus icon">
                            </div>
                            Add Money
                        </a>
                    </div>
                        
                </div>

                <div class="wallet_box">
                    <h4>Wallet ID:</h4>
                    <h3>{{request.user.profile.wallet_id}}</h3>
                </div>

                <div class="history_box">
                    <div class="history_btn_box">
                        <button id="historyBtn" class="active2"  data-filter="all">History</button>
                    </div>

                    <div class="history_btn_box">
                        <button data-filter=".incoming">Incoming</button>
                    </div>

                    <div  class="history_btn_box">
                        <button data-filter=".outgoing">Outgoing</button>
                    </div>

                </div>

                <div class="paypal_container">
                    {% if wallet_history_transaction %}
                    {% for transaction in wallet_history_transaction reversed %}
                    <div class="paypal_main mix {% if transaction.credit %}incoming{% else %}outgoing{% endif %}">
                        <p class="transaction-date" data-timestamp="{{ transaction.timestamp|date:'Y-m-d H:i:s.uO' }}"></p>
                        <div class="paypal_head">
                            <div class="paypal_box-icon_head">
                                <div class="paypal_text-box" style="margin-left: 10px;">
                                    <h4>{{ transaction.purpose }}</h4>
                                    <p class="transaction-time" data-timestamp="{{ transaction.timestamp|date:'Y-m-d H:i:s.uO' }}"></p>
                                </div>
                            </div>

                            <div class="money_box">
                                <div class="money_main_cash">
                                    <h4 {% if transaction.credit %}style="color:#001F8B;"{% else %}style="color:#D03020;"{% endif %}>{% if transaction.credit %}+{% else %}-{% endif %}${% if transaction.credit %}{{ transaction.funded_amount }}{% else %}{{ transaction.amount }}{% endif %}</h4>
                                </div>
                            </div>
                        </div>
                    </div><br>
                    {% endfor %}
                    {% else %}
                    <p style="text-align: center;">No transactions yet.</p>
                    {% endif %}
                </div>

                <!--<div class="load_more_trans-box">
                    <button>Load More Transactions</button>
                </div>-->

            </div>
        </div>

        <!-- <div class="message_logo">
            <img src="images/message-logo.svg" alt="Message Logo">
        </div> -->
    </div>
    <link rel="stylesheet" href="https://unpkg.com/swiper/swiper-bundle.min.css">
        
    <!-- SWIPER CAROUSEL INIT. CODE -->
    <script>
        // Transaction Date Elements
        var transactionDateElements = document.querySelectorAll('.transaction-date');
        
        // Formatting and displaying the date
        transactionDateElements.forEach(function (element) {
          var timestamp = new Date(element.dataset.timestamp);
          var userTimeZone = Intl.DateTimeFormat().resolvedOptions().timeZone;
          var dateOptions = { timeZone: userTimeZone, year: 'numeric', month: 'short', day: 'numeric' };
          var localDate = new Intl.DateTimeFormat('default', dateOptions).format(timestamp);
          element.textContent = localDate;
        });
        
        // Transaction Time Elements
        var transactionTimeElements = document.querySelectorAll('.transaction-time');
        
        // Formatting and displaying the time
        transactionTimeElements.forEach(function (element) {
          var timestamp = new Date(element.dataset.timestamp);
          var userTimeZone = Intl.DateTimeFormat().resolvedOptions().timeZone;
          var timeOptions = { timeZone: userTimeZone, hour12: true, hour: '2-digit', minute: '2-digit', second: '2-digit' };
          var localTime = new Intl.DateTimeFormat('default', timeOptions).format(timestamp);
          element.textContent = localTime;
        });
        var swiper = new Swiper('#cardCarousel', {
            slidesPerView: 1,
            spaceBetween: 0,
            navigation: {
                nextEl: '.swiper-button-next',
                prevEl: '.swiper-button-prev',
            },
        });
    </script>

    <!-- mixit up container -->
    <script>
        var mixer = mixitup('.paypal_container');
    </script>


    <script>
        // Get all transaction history buttons
        const buttons = document.querySelectorAll('.history_box button');

        // Function to remove active class from all buttons
        function removeAllActive() {
            buttons.forEach(button => {
                button.classList.remove('active2');
            });
        }

        // Function to handle button click
        function handleButtonClick(event) {
            const clickedButton = event.target;
            // Remove active class from all buttons
            removeAllActive();
            // Add active class to the clicked button
            clickedButton.classList.add('active2');
        }

        // Attach click event listener to each button
        buttons.forEach(button => {
            button.addEventListener('click', handleButtonClick);
        });


    </script>

    <script>
        //hide card details

        const validThruInputs = document.querySelectorAll('.year_span');

        validThruInputs.forEach(input => {
            const originalText = input.textContent.trim();
            
            if (originalText.length === 4) {
                const month = originalText.slice(0, 2);
                const year = originalText.slice(2);
                input.textContent = `${month}/${year}`;
            }
        });

        const secondInputs = document.querySelectorAll('.card_mask_number');
        function formatSecondInputs(secondInputs) {
            secondInputs.forEach(input => {
                const originalText = input.textContent.trim();
        
                if (originalText.length === 16) {
                    const formattedText = originalText.match(/.{1,4}/g).join(' ');
        
                    input.textContent = formattedText;
                }
            });
        }
        formatSecondInputs(secondInputs);

        document.getElementById("hideCardDetails").addEventListener("click", function() {
            const showText = document.getElementById("showText").textContent;
        
            document.querySelectorAll(".cvvHideElements").forEach(function(element) {
                const cardSecurityCode = element.getAttribute("data-card-security-code");
                element.textContent = showText === "Show" ? cardSecurityCode : "***";
            });
            document.querySelectorAll(".card_mask_number").forEach(function(element) {
                const cardNumber = element.getAttribute("data-card-number");
                const cardNumberMask = element.getAttribute("data-card-number-mask");
                element.textContent = showText === "Show" ? cardNumber : cardNumberMask;
                formatSecondInputs(secondInputs);
            });
    
            document.getElementById("showText").textContent = showText === "Show" ? "Hide" : "Show";
            document.getElementById("eyeIconHide").innerHTML = showText === "Show" ? '<svg width="21" height="14" viewBox="0 0 21 14" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M10.4609 13.1405C7.00435 13.1405 3.53925 11.0799 0.161097 7.01598C-0.053699 6.75748 -0.053699 6.38275 0.161097 6.12425C3.53925 2.06056 7.00435 0 10.4609 0C13.9171 0 17.3824 2.06056 20.7606 6.12425C20.9756 6.38275 20.9756 6.75748 20.7606 7.01598C17.3824 11.0797 13.9171 13.1405 10.4609 13.1405ZM1.6119 6.57011C4.5865 10.005 7.56157 11.7457 10.4609 11.7457C13.3604 11.7457 16.3352 10.0052 19.3098 6.57011C16.3352 3.13523 13.3604 1.39478 10.4609 1.39478C7.56157 1.39478 4.5865 3.13523 1.6119 6.57011Z" fill="black"/><path d="M10.4636 10.5288C8.28448 10.5288 6.51172 8.75599 6.51172 6.57688C6.51172 4.39777 8.28448 2.625 10.4636 2.625C12.6427 2.625 14.4155 4.39777 14.4155 6.57688C14.4155 8.75599 12.6427 10.5288 10.4636 10.5288ZM10.4636 4.01978C9.05371 4.01978 7.9065 5.16699 7.9065 6.57688C7.9065 7.98677 9.05371 9.13397 10.4636 9.13397C11.8735 9.13397 13.0207 7.98677 13.0207 6.57688C13.0207 5.16699 11.8735 4.01978 10.4636 4.01978Z" fill="black"/></svg>' : '<svg width="21" height="17" viewBox="0 0 21 17" fill="none" xmlns="http://www.w3.org/2000/svg" style="cursor: pointer;"><path d="M3.04557 16.1254C2.86791 16.1254 2.69024 16.0576 2.55491 15.922C2.28378 15.6511 2.28378 15.2116 2.55491 14.9407L17.2923 0.203346C17.5634 -0.0677819 18.0025 -0.0677819 18.2736 0.203346C18.5447 0.474242 18.5447 0.913783 18.2736 1.18468L3.53624 15.922C3.40091 16.0576 3.22324 16.1254 3.04557 16.1254Z" fill="black"/><path d="M5.85191 13.3118C5.73532 13.3118 5.6178 13.2824 5.51092 13.222C3.72569 12.2148 1.92542 10.6271 0.160317 8.5034C-0.0534389 8.24616 -0.0534389 7.87324 0.160317 7.61622C5.14171 1.62366 10.2385 0.0359883 15.3094 2.89717C15.4982 3.00382 15.6266 3.19259 15.656 3.40773C15.6854 3.62288 15.6125 3.83894 15.4589 3.99232L6.34281 13.1084C6.20933 13.2421 6.03166 13.3118 5.85191 13.3118ZM1.60386 8.0597C2.98541 9.655 4.3739 10.8917 5.74272 11.7458L13.803 3.68557C9.74648 1.83626 5.74272 3.27356 1.60386 8.0597Z" fill="black"/><path d="M7.9566 11.2101C7.77269 11.2101 7.59618 11.1372 7.46594 11.007C6.67939 10.2207 6.24609 9.17501 6.24609 8.06251C6.24609 5.76649 8.11414 3.89844 10.4102 3.89844C11.5088 3.89844 12.5454 4.32248 13.329 5.09283C13.4606 5.22238 13.5355 5.39866 13.5365 5.58327C13.5374 5.76788 13.4652 5.94531 13.3354 6.07648L8.44935 11.0049C8.31934 11.1358 8.1426 11.2099 7.95799 11.2103C7.95753 11.2101 7.95707 11.2101 7.9566 11.2101ZM10.4102 5.28646C8.87941 5.28646 7.63412 6.53175 7.63412 8.06251C7.63412 8.56567 7.76691 9.04824 8.01606 9.4702L11.797 5.6566C11.3795 5.41509 10.9043 5.28646 10.4102 5.28646Z" fill="black"/><path d="M10.4043 14.6C9.58263 14.6 8.76092 14.4841 7.93898 14.2519C7.57022 14.1478 7.35577 13.7642 7.45987 13.3952C7.56398 13.0265 7.94684 12.8113 8.31652 12.9164C11.8865 13.9248 15.5523 12.2929 19.2167 8.06244C18.2966 7.00014 17.3706 6.09283 16.458 5.36042C16.1591 5.12052 16.1112 4.68376 16.3511 4.38464C16.5912 4.08575 17.0282 4.03786 17.3269 4.27776C18.4364 5.16818 19.5579 6.29225 20.6602 7.61874C20.8742 7.87575 20.8742 8.2489 20.6602 8.50591C17.2913 12.5592 13.8515 14.6 10.4043 14.6Z" fill="black"/><path d="M10.4137 12.2293C10.3244 12.2293 10.2356 12.2263 10.1479 12.221C9.7653 12.1976 9.47404 11.8687 9.49741 11.4858C9.521 11.1037 9.85066 10.8129 10.2326 10.8355C10.2925 10.8392 10.3529 10.8413 10.4137 10.8413C11.9445 10.8413 13.1898 9.59603 13.1898 8.06527C13.1898 8.00281 13.1877 7.94081 13.1838 7.8795C13.159 7.4971 13.4489 7.16675 13.8313 7.142C14.2165 7.11817 14.5443 7.40711 14.569 7.78951C14.5748 7.88066 14.5778 7.9725 14.5778 8.06527C14.5778 10.3613 12.7098 12.2293 10.4137 12.2293Z" fill="black"/></svg>';   
        });
    </script>
{% endblock %}